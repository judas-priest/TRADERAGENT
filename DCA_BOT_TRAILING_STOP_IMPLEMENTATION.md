# DCA Bot Ñ Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-Ğ¡Ñ‚Ğ¾Ğ¿Ğ¾Ğ¼: Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
## TRADERAGENT v2.0 - Autonomous DCA-Grid SMC Trend-Follower Trading Bot

**Ğ”Ğ°Ñ‚Ğ°:** 2026-02-13
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

---

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€](#Ğ¾Ğ±Ğ·Ğ¾Ñ€)
2. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° DCA-Ğ±Ğ¾Ñ‚Ğ°](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°-dca-Ğ±Ğ¾Ñ‚Ğ°)
3. [Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿: Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ](#Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿-Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ-ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ)
4. [Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ²](#ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°-Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ-Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ²)
5. [ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…-Ğ¸-Ğ±Ğ°Ğ·Ğ°-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
6. [ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸](#ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ-ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸)
7. [Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²](#Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ-Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²)
8. [ĞŸĞ»Ğ°Ğ½ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹](#Ğ¿Ğ»Ğ°Ğ½-Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸-Ğ¸-Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)
9. [Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ](#Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
10. [Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹](#ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸-Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹)

---

## ğŸ“– ĞĞ±Ğ·Ğ¾Ñ€

### Ğ¦ĞµĞ»ÑŒ
Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ DCA (Dollar Cost Averaging) Ğ±Ğ¾Ñ‚ Ñ:
- **Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿** - Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ¾Ğ¿-Ğ»Ğ¾ÑÑ, ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ·Ğ° Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼Ğ¾Ğ¼ Ñ†ĞµĞ½Ñ‹
- **Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°** - Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ² Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°Ğ¼ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ°
- **Safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ°** - Ğ¿Ğ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾Ğµ Ğ½Ğ°Ñ€Ğ°Ñ‰Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¸
- **ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** - ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğ° ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğµ Ğ±Ğ¾Ñ‚Ğ°, Ğ° Ğ½Ğµ Ğ±Ğ¸Ñ€Ğ¶Ğ¸

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹
1. **ĞĞ²Ñ‚Ğ¾Ğ½Ğ¾Ğ¼Ğ½Ğ¾ÑÑ‚ÑŒ** - Ğ±Ğ¾Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ±ĞµĞ· Ğ²Ğ¼ĞµÑˆĞ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ° Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°
2. **Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸** - Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ÑƒÑ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ
3. **ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¹ Ğ²Ñ…Ğ¾Ğ´** - Ğ¾Ñ€Ğ´ĞµÑ€Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ½Ñ‹Ğ¼ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°Ğ¼
4. **ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ** - Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾Ğ´ Ñ€Ñ‹Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° DCA-Ğ±Ğ¾Ñ‚Ğ°

### ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DCA Bot Architecture                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  1. SIGNAL GENERATION LAYER                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DCA Signal Generator                                â”‚   â”‚
â”‚  â”‚  - Trend Detection (EMA crossover, trend strength)   â”‚   â”‚
â”‚  â”‚  - Entry Conditions (price levels, indicators)       â”‚   â”‚
â”‚  â”‚  - Signal Validation (confirmations, filters)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  2. DEAL MANAGEMENT LAYER                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DCA Position Manager                                â”‚   â”‚
â”‚  â”‚  - Open Deal (base order)                            â”‚   â”‚
â”‚  â”‚  - Calculate Safety Orders                           â”‚   â”‚
â”‚  â”‚  - Track Average Entry Price                         â”‚   â”‚
â”‚  â”‚  - Update Deal State                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  3. ACTIVE DEAL MONITORING                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  manage_active_deal()                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Safety Order Logic                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Check price drops                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Place safety orders                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Update average entry                      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Trailing Stop Logic (NEW)                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Track highest_price_since_entry           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Check activation condition                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Calculate dynamic stop price              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Execute exit on stop trigger              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     4. EXECUTION LAYER                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Exchange Client (CCXT)                              â”‚   â”‚
â”‚  â”‚  - Place orders (market/limit)                       â”‚   â”‚
â”‚  â”‚  - Cancel orders                                     â”‚   â”‚
â”‚  â”‚  - Get current price                                 â”‚   â”‚
â”‚  â”‚  - Get order status                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    5. PERSISTENCE LAYER                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Database Manager (PostgreSQL)                       â”‚   â”‚
â”‚  â”‚  - Store deal state                                  â”‚   â”‚
â”‚  â”‚  - Track highest_price_since_entry                   â”‚   â”‚
â”‚  â”‚  - Save orders and trades                            â”‚   â”‚
â”‚  â”‚  - Performance metrics                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

#### 1. DCA Signal Generator (`src/strategies/dca/dca_signal_generator.py`)
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ñ‹Ğ½ĞºĞ° Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹ Ğ²Ñ…Ğ¾Ğ´Ğ°
- Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² Ğ½Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ DCA-ÑĞ´ĞµĞ»ĞºĞ¸
- Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹ (Ñ‚Ñ€ĞµĞ½Ğ´, ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸, Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹)

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:**
```python
- analyze_market(pair, timeframe) â†’ MarketState
- should_open_deal(pair, config) â†’ bool
- calculate_entry_price(pair, config) â†’ float
- validate_signal(signal, filters) â†’ bool
```

#### 2. DCA Position Manager (`src/strategies/dca/dca_position_manager.py`)
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¼Ğ¸ DCA-ÑĞ´ĞµĞ»ĞºĞ°Ğ¼Ğ¸
- Ğ Ğ°ÑÑ‡ĞµÑ‚ Ğ¸ Ñ€Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ²
- ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ€ĞµĞ´Ğ½ĞµĞ¹ Ñ†ĞµĞ½Ñ‹ Ğ²Ñ…Ğ¾Ğ´Ğ°
- Ğ Ğ°ÑÑ‡ĞµÑ‚ Ñ†ĞµĞ»ĞµĞ²Ñ‹Ñ… ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹ (TP, TS)

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:**
```python
- open_deal(pair, entry_price, volume, config) â†’ Deal
- calculate_safety_orders(deal, config) â†’ List[SafetyOrder]
- get_average_entry_price(deal_id) â†’ float
- update_deal_state(deal_id, new_state) â†’ None
```

#### 3. Active Deal Manager (`src/strategies/dca/manage_active_deal.py`)
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- Ğ¦Ğ¸ĞºĞ» Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞ´ĞµĞ»Ğ¾Ğº
- Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ²
- **Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°** (ĞĞĞ’ĞĞ•)
- Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:**
```python
- manage_active_deal(deal, strategy_config) â†’ None
- check_safety_order_triggers(deal, current_price) â†’ List[Order]
- update_trailing_stop(deal, current_price) â†’ None
- check_exit_conditions(deal, current_price) â†’ bool
```

---

## ğŸ¯ Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿: Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

### Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿?

Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ - ÑÑ‚Ğ¾ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ¾Ğ¿-Ğ»Ğ¾ÑÑ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹:
1. **Ğ¡Ğ»ĞµĞ´ÑƒĞµÑ‚ Ğ·Ğ° Ñ†ĞµĞ½Ğ¾Ğ¹** - Ğ¿Ñ€Ğ¸ Ñ€Ğ¾ÑÑ‚Ğµ Ñ†ĞµĞ½Ñ‹ ÑÑ‚Ğ¾Ğ¿ Ñ‚Ğ¾Ğ¶Ğµ Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ÑÑ
2. **Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ** - Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ÑƒÑ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ
3. **ĞĞµ Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ** - Ğ¿Ñ€Ğ¸ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¸ Ñ†ĞµĞ½Ñ‹ ÑÑ‚Ğ¾Ğ¿ Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ
4. **ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ ÑƒÑĞ»Ğ¾Ğ²Ğ½Ğ¾** - Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸

### Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ½ÑƒĞ¶ĞµĞ½ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ Ğ² DCA?

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ TP:**
- DCA Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ² Ğ½Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰ĞµĞ¼ Ñ‚Ñ€ĞµĞ½Ğ´Ğµ
- ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ÑƒÑÑ€ĞµĞ´Ğ½ÑĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ°
- Ğ¤Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TP Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ½Ğµ ÑÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸ Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğµ
- Ğ¦ĞµĞ½Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ´Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒÑÑ
- Ğ‘ĞµĞ· Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³Ğ° Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ Ñ‚ĞµÑ€ÑĞµÑ‚ÑÑ

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ¾Ğ¼:**
- ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸ Ñ€Ğ°ÑÑ‚Ğ¸ Ğ½ĞµĞ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ğ¾
- Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ¾Ñ‚ Ğ¿Ğ¾Ñ‚ĞµÑ€Ğ¸ Ğ½Ğ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¿Ñ€Ğ¸ Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğµ Ñ‚Ñ€ĞµĞ½Ğ´Ğ°
- ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ Ñ€Ğ¸ÑĞº/Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°

#### ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸

| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ |
|----------|-----|----------|--------|
| `use_trailing_stop` | boolean | Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ TP | `true` |
| `trailing_activation` | float | ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ (%) Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³Ğ° | `1.5` |
| `trailing_distance` | float | Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼Ğ° (% Ğ¸Ğ»Ğ¸ Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ğ¾) | `0.8` |
| `trailing_type` | string | `"percentage"` Ğ¸Ğ»Ğ¸ `"absolute"` | `"percentage"` |

#### Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ (Ğ¿ÑĞµĞ²Ğ´Ğ¾ĞºĞ¾Ğ´)

```python
async def manage_active_deal(deal, strategy):
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ñ†ĞµĞ½Ñƒ
    current_price = await exchange.get_price(strategy.pair)
    avg_entry = calculate_avg_entry_price(deal.id)

    # --- Ğ‘Ğ›ĞĞš 1: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ² ---
    if price_dropped_to_next_safety_level(current_price, deal):
        place_safety_order(deal, current_price)
        avg_entry = recalculate_avg_entry(deal.id)

    # --- Ğ‘Ğ›ĞĞš 2: Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ---
    if strategy.use_trailing_stop:
        # Ğ¨Ğ°Ğ³ 1: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼
        new_highest = max(deal.highest_price_since_entry or 0, current_price)
        if new_highest > deal.highest_price_since_entry:
            database.update_deal(deal.id, highest_price_since_entry=new_highest)
            deal.highest_price_since_entry = new_highest

        # Ğ¨Ğ°Ğ³ 2: Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ
        profit_percent = (current_price - avg_entry) / avg_entry * 100

        # Ğ¨Ğ°Ğ³ 3: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³Ğ°
        if profit_percent >= strategy.trailing_activation:
            # Ğ¨Ğ°Ğ³ 4: Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ¾Ğ¿-Ñ†ĞµĞ½Ñƒ
            if strategy.trailing_type == 'percentage':
                stop_price = new_highest * (1 - strategy.trailing_distance / 100)
            else:  # absolute
                stop_price = new_highest - strategy.trailing_distance

            # Ğ¨Ğ°Ğ³ 5: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ¿Ğ°
            if current_price <= stop_price:
                # Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸
                total_volume = database.get_total_bought_volume(deal.id)
                await place_sell_order(
                    strategy.pair,
                    current_price,
                    total_volume,
                    order_type='market'
                )
                database.close_deal(deal.id,
                    reason='trailing_stop',
                    profit_percent=profit_percent
                )
                await cancel_all_buy_orders(deal.id)
                return  # Ğ¡Ğ´ĞµĞ»ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°
    else:
        # --- Ğ‘Ğ›ĞĞš 3: Ğ¤Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞ¹Ğº-Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ‚ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) ---
        profit_percent = (current_price - avg_entry) / avg_entry * 100
        if profit_percent >= strategy.take_profit_percentage:
            total_volume = database.get_total_bought_volume(deal.id)
            await place_sell_order(strategy.pair, current_price, total_volume)
            database.close_deal(deal.id, reason='take_profit')
            return
```

#### Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°

```
Ğ¦ĞµĞ½Ğ°
  â†‘
  â”‚                                â­ Highest = $3500
  â”‚                               â•±â”‚
  â”‚                              â•± â”‚ â† Trailing activated
  â”‚                             â•±  â”‚   (profit > 1.5%)
  â”‚                            â•±   â”‚
  â”‚                           â•±    â”‚ Stop = $3472
  â”‚                          â•±     â”‚ (0.8% Ğ¾Ñ‚ highest)
  â”‚                         â•±      â”‚
$3400 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€
  â”‚                                â”‚
  â”‚    â•±â•²                          â”‚
  â”‚   â•±  â•²   â† Safety order 2      â”‚
  â”‚  â•±    â•²  @ $3250               â”‚
  â”‚ â•±      â•²                       â”‚
$3300 â”€â”€â”€â”€â”€â”€â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€
  â”‚         â•²                      â”‚
  â”‚          â•²  â† Safety order 1   â”‚
  â”‚           â•² @ $3150            â”‚
  â”‚            â•²                   â”‚
$3200 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â† Avg entry Ğ¿Ğ¾ÑĞ»Ğµ SO
  â”‚                                â”‚
  â”‚                                â”‚
$3100 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â† Base order
  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Ğ’Ñ€ĞµĞ¼Ñ
      Entry   SO1   SO2   Price    Exit
                         rises    (trailing)
```

**Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ°:**
- Base order @ $3100 - Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ…Ğ¾Ğ´
- Safety order 1 @ $3150 - Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ ÑƒÑÑ€ĞµĞ´Ğ½ĞµĞ½Ğ¸Ğµ (Ñ†ĞµĞ½Ğ° ÑƒĞ¿Ğ°Ğ»Ğ°)
- Safety order 2 @ $3250 - Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğµ ÑƒÑÑ€ĞµĞ´Ğ½ĞµĞ½Ğ¸Ğµ
- Average entry = $3200 (Ğ¿Ğ¾ÑĞ»Ğµ Ğ²ÑĞµÑ… SO)
- Highest = $3500 - Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ†ĞµĞ½Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ…Ğ¾Ğ´Ğ°
- Stop = $3472 - Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ¾Ğ¿ (0.8% Ğ¾Ñ‚ highest)
- Exit - Ğ²Ñ‹Ñ…Ğ¾Ğ´ Ğ¿Ñ€Ğ¸ ĞºĞ°ÑĞ°Ğ½Ğ¸Ğ¸ ÑÑ‚Ğ¾Ğ¿Ğ°

### Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

#### 1. ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ½Ğµ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ´Ğ¾Ğ·Ğ°ĞºÑƒĞ¿ĞºĞµ
```python
# âŒ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ
if safety_order_filled:
    deal.highest_price_since_entry = current_price  # Ğ¡Ğ±Ñ€Ğ¾Ñ!

# âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ
if safety_order_filled:
    # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ, Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°Ñ ÑƒĞ¶Ğµ Ğ½Ğ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ½ÑƒÑ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ
    pass
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ:** Safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¸ Ñ†ĞµĞ½Ñ‹. Ğ•ÑĞ»Ğ¸ ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼, Ğ¼Ñ‹ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞµĞ¼ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñƒ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸, Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚Ğ¾Ğ¹ Ñ€Ğ°Ğ½ĞµĞµ.

#### 2. ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ½Ğµ Ğ±Ğ¸Ñ€Ğ¶ĞµĞ²Ñ‹Ğµ Ğ¾Ñ€Ğ´ĞµÑ€Ğ°)
```python
# âŒ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ (Ğ½Ğµ Ğ²ÑĞµ Ğ±Ğ¸Ñ€Ğ¶Ğ¸ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚)
exchange.create_trailing_stop_order(...)

# âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ (Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°)
# Ğ’ Ñ†Ğ¸ĞºĞ»Ğµ manage_active_deal:
if current_price <= calculated_stop_price:
    await place_sell_order(..., order_type='market')
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ:**
- ĞĞµ Ğ²ÑĞµ Ğ±Ğ¸Ñ€Ğ¶Ğ¸ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ trailing stop Ğ½Ğ° ÑĞ¿Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ¼ Ñ€Ñ‹Ğ½ĞºĞµ
- ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ°ĞµÑ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ³Ğ¸Ğ±ĞºĞ¾ÑÑ‚Ğ¸
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½ÑƒÑ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ (Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹, ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ)

#### 3. ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸
```python
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ
if profit_percent >= strategy.trailing_activation:
    # Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½
    if current_price <= stop_price:
        exit_position()
else:
    # Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ¾Ğ¿-Ğ»Ğ¾ÑÑ Ğ¸Ğ»Ğ¸ Ğ¶Ğ´ĞµĞ¼
    pass
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ:** Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ¶Ğ´ĞµĞ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… ĞºĞ¾Ğ»ĞµĞ±Ğ°Ğ½Ğ¸ÑÑ… Ñ†ĞµĞ½Ñ‹.

#### 4. Ğ”Ğ²Ğ° Ñ‚Ğ¸Ğ¿Ğ° Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
```python
# Percentage (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹)
stop_price = highest * (1 - distance / 100)
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: highest=$3500, distance=0.8% â†’ stop=$3472

# Absolute (Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ñ‹Ğ¹)
stop_price = highest - distance
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: highest=$3500, distance=$25 â†’ stop=$3475
```

**ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:**
- **Percentage** - Ğ´Ğ»Ñ Ğ²Ğ¾Ğ»Ğ°Ñ‚Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ñ€Ñ‹Ğ½ĞºĞ¾Ğ² (BTC, ETH)
- **Absolute** - Ğ´Ğ»Ñ ÑÑ‚ĞµĞ¹Ğ±Ğ»ĞºĞ¾Ğ¸Ğ½Ğ¾Ğ² Ğ¸Ğ»Ğ¸ low-cap Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²

---

## ğŸ”” Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ²

### ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
**Ğ‘Ğ¾Ñ‚ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾Ñ€Ğ´ĞµÑ€Ğ° Ğ¢ĞĞ›Ğ¬ĞšĞ ĞºĞ¾Ğ³Ğ´Ğ° Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ´Ğ°ÑÑ‚ ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½Ñ‹ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ½Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸.**

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸

#### 1. Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° (Entry Conditions)

##### A. Ğ¢Ñ€ĞµĞ½Ğ´Ğ¾Ğ²Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
```python
def check_trend_conditions(pair, config):
    # EMA crossover
    ema_fast = get_ema(pair, period=config.ema_fast)
    ema_slow = get_ema(pair, period=config.ema_slow)

    if config.trend_direction == 'down':
        # Ğ”Ğ»Ñ DCA Ğ½ÑƒĞ¶ĞµĞ½ Ğ½Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´
        trend_ok = ema_fast < ema_slow
    else:
        trend_ok = False

    # Ğ¡Ğ¸Ğ»Ğ° Ñ‚Ñ€ĞµĞ½Ğ´Ğ° (ADX)
    adx = get_adx(pair, period=14)
    trend_strength_ok = adx > config.min_trend_strength

    return trend_ok and trend_strength_ok
```

##### B. Ğ¦ĞµĞ½Ğ¾Ğ²Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
```python
def check_price_conditions(pair, config):
    current_price = get_current_price(pair)

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğ°
    target_price_min = config.entry_price_min
    target_price_max = config.entry_price_max

    price_in_range = target_price_min <= current_price <= target_price_max

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¾Ñ‚ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ñ… ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹
    support_level = get_nearest_support(pair)
    distance_from_support = (current_price - support_level) / support_level

    near_support = distance_from_support <= config.max_distance_from_support

    return price_in_range and near_support
```

##### C. Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
```python
def check_indicator_conditions(pair, config):
    # RSI - Ğ¿ĞµÑ€ĞµĞ¿Ñ€Ğ¾Ğ´Ğ°Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ
    rsi = get_rsi(pair, period=14)
    rsi_ok = rsi < config.rsi_oversold_threshold  # ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, <35

    # Volume - Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ
    volume_24h = get_24h_volume(pair)
    avg_volume = get_avg_volume(pair, period=30)
    volume_ok = volume_24h > avg_volume * config.min_volume_multiplier

    # Bollinger Bands - Ñ†ĞµĞ½Ğ° Ñƒ Ğ½Ğ¸Ğ¶Ğ½ĞµĞ¹ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
    bb_lower = get_bollinger_lower(pair, period=20, std=2)
    current_price = get_current_price(pair)
    at_bb_lower = current_price <= bb_lower * 1.02  # 2% tolerance

    return rsi_ok and volume_ok and at_bb_lower
```

#### 2. Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ

##### A. Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
```python
def check_timing_filters(deal_history, config):
    # ĞĞµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ÑĞ´ĞµĞ»ĞºÑƒ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹
    last_deal = get_last_closed_deal(config.pair)
    if last_deal:
        time_since_last = now() - last_deal.closed_at
        if time_since_last < config.min_time_between_deals:
            return False

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑÑƒÑ‚Ğ¾Ğº (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
    current_hour = get_current_hour_utc()
    if config.trading_hours:
        if current_hour not in config.trading_hours:
            return False

    return True
```

##### B. Ğ Ğ¸ÑĞº-Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
```python
def check_risk_filters(account_state, config):
    # ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ´ĞµĞ»Ğ¾Ğº
    active_deals = get_active_deals_count(config.pair)
    if active_deals >= config.max_concurrent_deals:
        return False

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ½ĞµĞ²Ğ½Ğ¾Ğ³Ğ¾ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° Ğ¿Ğ¾Ñ‚ĞµÑ€ÑŒ
    daily_pnl = get_daily_pnl()
    if daily_pnl < -config.max_daily_loss:
        return False

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ°Ğ¿Ğ¸Ñ‚Ğ°Ğ»Ğ°
    available_balance = get_available_balance()
    required_capital = calculate_required_capital(config)
    if available_balance < required_capital:
        return False

    return True
```

##### C. Confluence Score
```python
def calculate_confluence_score(pair, config):
    """
    Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²
    """
    score = 0
    max_score = 0

    # Ğ¢Ñ€ĞµĞ½Ğ´ (Ğ²ĞµÑ 3)
    if check_trend_conditions(pair, config):
        score += 3
    max_score += 3

    # Ğ¦ĞµĞ½Ğ° (Ğ²ĞµÑ 2)
    if check_price_conditions(pair, config):
        score += 2
    max_score += 2

    # Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹ (Ğ²ĞµÑ 2)
    if check_indicator_conditions(pair, config):
        score += 2
    max_score += 2

    # Volume (Ğ²ĞµÑ 1)
    if check_volume_condition(pair, config):
        score += 1
    max_score += 1

    confluence = score / max_score
    return confluence
```

#### 3. Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°

```python
async def should_open_dca_deal(pair, config):
    """
    Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¸Ñ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ
    Returns: (bool, str) - (should_open, reason)
    """

    # Ğ¨Ğ°Ğ³ 1: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
    if not check_timing_filters(pair, config):
        return False, "Timing filters not passed"

    if not check_risk_filters(account_state, config):
        return False, "Risk filters not passed"

    # Ğ¨Ğ°Ğ³ 2: Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
    trend_ok = check_trend_conditions(pair, config)
    price_ok = check_price_conditions(pair, config)
    indicators_ok = check_indicator_conditions(pair, config)

    # Ğ¨Ğ°Ğ³ 3: Confluence check
    confluence = calculate_confluence_score(pair, config)

    if config.require_confluence:
        # Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ confluence
        if confluence >= config.min_confluence_score:  # ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, >= 0.75
            return True, f"Signal confirmed (confluence: {confluence:.2f})"
        else:
            return False, f"Confluence too low: {confluence:.2f}"
    else:
        # ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° AND
        if trend_ok and price_ok and indicators_ok:
            return True, "All conditions met"
        else:
            return False, "Not all conditions met"
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²

```yaml
dca:
  signal_config:
    # Ğ¢Ñ€ĞµĞ½Ğ´Ğ¾Ğ²Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
    ema_fast: 12
    ema_slow: 26
    trend_direction: "down"  # Ğ”Ğ»Ñ DCA Ğ½ÑƒĞ¶ĞµĞ½ Ğ½Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´
    min_trend_strength: 20   # ADX > 20

    # Ğ¦ĞµĞ½Ğ¾Ğ²Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
    entry_price_min: 3000    # USD
    entry_price_max: 3200    # USD
    max_distance_from_support: 0.02  # 2%

    # Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
    rsi_oversold_threshold: 35
    min_volume_multiplier: 1.2  # Volume > 1.2x avg
    use_bollinger_bands: true

    # Confluence
    require_confluence: true
    min_confluence_score: 0.75  # 75% ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ ÑĞ¾Ğ²Ğ¿Ğ°ÑÑ‚ÑŒ

    # Ğ Ğ¸ÑĞº-Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
    max_concurrent_deals: 3
    max_daily_loss: 500  # USD
    min_time_between_deals: 3600  # 1 Ñ‡Ğ°Ñ

    # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
    trading_hours: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]  # 24/7
```

---

## ğŸ’¾ ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¡Ñ…ĞµĞ¼Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `dca_deals`

```sql
CREATE TABLE dca_deals (
    -- Ğ˜Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
    id BIGSERIAL PRIMARY KEY,
    pair VARCHAR(20) NOT NULL,
    strategy_id INTEGER REFERENCES strategies(id),

    -- Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    closed_at TIMESTAMP,

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ´ĞµĞ»ĞºĞ¸
    status VARCHAR(20) NOT NULL DEFAULT 'active',
    -- 'active', 'closed', 'cancelled'

    close_reason VARCHAR(50),
    -- 'take_profit', 'trailing_stop', 'stop_loss', 'manual', 'error'

    -- Ğ¦ĞµĞ½Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    base_order_price DECIMAL(20, 8) NOT NULL,
    base_order_volume DECIMAL(20, 8) NOT NULL,
    base_order_cost DECIMAL(20, 8) NOT NULL,

    average_entry_price DECIMAL(20, 8) NOT NULL,
    total_volume DECIMAL(20, 8) NOT NULL,
    total_cost DECIMAL(20, 8) NOT NULL,

    -- Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (ĞĞĞ’ĞĞ•)
    highest_price_since_entry DECIMAL(20, 8),
    trailing_stop_activated BOOLEAN DEFAULT FALSE,
    trailing_activation_price DECIMAL(20, 8),
    trailing_activation_time TIMESTAMP,

    -- Safety orders
    safety_orders_count INTEGER DEFAULT 0,
    max_safety_orders INTEGER NOT NULL,
    next_safety_order_price DECIMAL(20, 8),

    -- ĞŸÑ€Ğ¾Ñ„Ğ¸Ñ‚/ÑƒĞ±Ñ‹Ñ‚Ğ¾Ğº
    current_profit_percent DECIMAL(10, 4),
    realized_profit_usd DECIMAL(20, 8),
    realized_profit_percent DECIMAL(10, 4),

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    config JSONB,  -- ĞšĞ¾Ğ¿Ğ¸Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ
    notes TEXT,

    INDEX idx_pair_status (pair, status),
    INDEX idx_status_created (status, created_at),
    INDEX idx_trailing_activated (trailing_stop_activated, status)
);
```

### Ğ¡Ñ…ĞµĞ¼Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `dca_orders`

```sql
CREATE TABLE dca_orders (
    -- Ğ˜Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
    id BIGSERIAL PRIMARY KEY,
    deal_id BIGINT NOT NULL REFERENCES dca_deals(id) ON DELETE CASCADE,
    exchange_order_id VARCHAR(100),

    -- Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    filled_at TIMESTAMP,

    -- Ğ¢Ğ¸Ğ¿ Ğ¾Ñ€Ğ´ĞµÑ€Ğ°
    order_type VARCHAR(20) NOT NULL,
    -- 'base_order', 'safety_order_1', 'safety_order_2', ..., 'take_profit', 'trailing_stop'

    side VARCHAR(10) NOT NULL,  -- 'buy', 'sell'

    -- Ğ¦ĞµĞ½Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    price DECIMAL(20, 8) NOT NULL,
    volume DECIMAL(20, 8) NOT NULL,
    filled_volume DECIMAL(20, 8) DEFAULT 0,
    cost DECIMAL(20, 8) NOT NULL,

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    -- 'pending', 'placed', 'partially_filled', 'filled', 'cancelled', 'error'

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    exchange_response JSONB,
    error_message TEXT,

    INDEX idx_deal_id (deal_id),
    INDEX idx_status (status),
    INDEX idx_order_type (order_type)
);
```

### Ğ¡Ñ…ĞµĞ¼Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `dca_signals`

```sql
CREATE TABLE dca_signals (
    -- Ğ˜Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
    id BIGSERIAL PRIMARY KEY,
    pair VARCHAR(20) NOT NULL,

    -- Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),

    -- Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»
    signal_type VARCHAR(20) NOT NULL,  -- 'open_deal', 'close_deal'
    signal_strength DECIMAL(5, 4),     -- Confluence score 0-1

    -- Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ
    trend_ok BOOLEAN,
    price_ok BOOLEAN,
    indicators_ok BOOLEAN,
    risk_ok BOOLEAN,
    timing_ok BOOLEAN,

    -- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€Ñ‹Ğ½ĞºĞ°
    market_price DECIMAL(20, 8),
    ema_fast DECIMAL(20, 8),
    ema_slow DECIMAL(20, 8),
    rsi DECIMAL(5, 2),
    adx DECIMAL(5, 2),
    volume_24h DECIMAL(20, 8),

    -- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    action_taken BOOLEAN DEFAULT FALSE,
    deal_id BIGINT REFERENCES dca_deals(id),

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    details JSONB,

    INDEX idx_pair_created (pair, created_at),
    INDEX idx_action_taken (action_taken)
);
```

### ORM ĞœĞ¾Ğ´ĞµĞ»Ğ¸ (SQLAlchemy)

```python
from sqlalchemy import Column, Integer, String, DECIMAL, Boolean, TIMESTAMP, Text
from sqlalchemy.dialects.postgresql import JSONB
from sqlalchemy.ext.declarative import declarative_base
from datetime import datetime

Base = declarative_base()

class DCADeal(Base):
    __tablename__ = 'dca_deals'

    # Ğ˜Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
    id = Column(Integer, primary_key=True)
    pair = Column(String(20), nullable=False)
    strategy_id = Column(Integer)

    # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸
    created_at = Column(TIMESTAMP, default=datetime.utcnow)
    updated_at = Column(TIMESTAMP, default=datetime.utcnow, onupdate=datetime.utcnow)
    closed_at = Column(TIMESTAMP)

    # Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    status = Column(String(20), default='active')
    close_reason = Column(String(50))

    # Ğ¦ĞµĞ½Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    base_order_price = Column(DECIMAL(20, 8), nullable=False)
    base_order_volume = Column(DECIMAL(20, 8), nullable=False)
    base_order_cost = Column(DECIMAL(20, 8), nullable=False)

    average_entry_price = Column(DECIMAL(20, 8), nullable=False)
    total_volume = Column(DECIMAL(20, 8), nullable=False)
    total_cost = Column(DECIMAL(20, 8), nullable=False)

    # Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿
    highest_price_since_entry = Column(DECIMAL(20, 8))
    trailing_stop_activated = Column(Boolean, default=False)
    trailing_activation_price = Column(DECIMAL(20, 8))
    trailing_activation_time = Column(TIMESTAMP)

    # Safety orders
    safety_orders_count = Column(Integer, default=0)
    max_safety_orders = Column(Integer, nullable=False)
    next_safety_order_price = Column(DECIMAL(20, 8))

    # ĞŸÑ€Ğ¾Ñ„Ğ¸Ñ‚/ÑƒĞ±Ñ‹Ñ‚Ğ¾Ğº
    current_profit_percent = Column(DECIMAL(10, 4))
    realized_profit_usd = Column(DECIMAL(20, 8))
    realized_profit_percent = Column(DECIMAL(10, 4))

    # ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    config = Column(JSONB)
    notes = Column(Text)

    def to_dict(self):
        return {
            'id': self.id,
            'pair': self.pair,
            'status': self.status,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'average_entry_price': float(self.average_entry_price),
            'total_volume': float(self.total_volume),
            'highest_price_since_entry': float(self.highest_price_since_entry) if self.highest_price_since_entry else None,
            'current_profit_percent': float(self.current_profit_percent) if self.current_profit_percent else None,
        }
```

---

## âš™ï¸ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸

### ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ DCA Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ¾Ğ¼

```yaml
strategies:
  dca:
    enabled: true
    pairs:
      - "BTC/USDT"
      - "ETH/USDT"

    # ========== SIGNAL CONFIGURATION ==========
    signal_config:
      # Ğ¢Ñ€ĞµĞ½Ğ´Ğ¾Ğ²Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
      trend:
        ema_fast: 12
        ema_slow: 26
        direction: "down"  # up, down, any
        min_strength: 20   # ADX threshold

      # Ğ¦ĞµĞ½Ğ¾Ğ²Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
      price:
        entry_range:
          min: 3000
          max: 3200
        max_distance_from_support: 0.02  # 2%

      # Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
      indicators:
        rsi_threshold: 35
        use_bollinger_bands: true
        min_volume_multiplier: 1.2

      # Confluence
      confluence:
        enabled: true
        min_score: 0.75

      # Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
      filters:
        max_concurrent_deals: 3
        min_time_between_deals: 3600  # seconds
        max_daily_loss: 500  # USD
        trading_hours: null  # null = 24/7

    # ========== ORDER CONFIGURATION ==========
    order_config:
      # Base order
      base_order:
        type: "market"  # market, limit
        volume_usd: 100

      # Safety orders
      safety_orders:
        max_count: 5
        volume_multiplier: 1.5  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ SO Ğ±Ğ¾Ğ»ÑŒÑˆĞµ
        price_step_percent: 2.0  # % Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ SO

        # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:
        # SO1: -2% Ğ¾Ñ‚ entry, volume = 100 * 1.5 = $150
        # SO2: -4% Ğ¾Ñ‚ entry, volume = 150 * 1.5 = $225
        # SO3: -6% Ğ¾Ñ‚ entry, volume = 225 * 1.5 = $337.5
        # Ğ¸ Ñ‚.Ğ´.

    # ========== EXIT CONFIGURATION ==========
    exit_config:
      # Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ (ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢ ĞµÑĞ»Ğ¸ enabled=true)
      trailing_stop:
        enabled: true
        activation_profit: 1.5  # % Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸
        distance: 0.8           # % Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼Ğ°
        type: "percentage"      # percentage, absolute

      # Ğ¤Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞ¹Ğº-Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ‚ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ĞµÑĞ»Ğ¸ trailing_stop=false)
      take_profit:
        enabled: true
        percent: 3.0  # % Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸ Ğ¾Ñ‚ ÑÑ€ĞµĞ´Ğ½ĞµĞ¹ Ñ†ĞµĞ½Ñ‹ Ğ²Ñ…Ğ¾Ğ´Ğ°

      # Ğ¡Ñ‚Ğ¾Ğ¿-Ğ»Ğ¾ÑÑ (ÑĞºÑÑ‚Ñ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ñ…Ğ¾Ğ´)
      stop_loss:
        enabled: true
        percent: 10.0  # % ÑƒĞ±Ñ‹Ñ‚ĞºĞ° Ğ¾Ñ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¾Ñ€Ğ´ĞµÑ€Ğ°
        type: "from_base_order"  # from_base_order, from_average_entry

    # ========== RISK MANAGEMENT ==========
    risk_config:
      max_position_size_usd: 5000
      max_concurrent_deals: 3
      max_daily_loss_usd: 500
      max_consecutive_losses: 3

      # Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ pump&dump
      max_price_change_percent: 10  # Ğ—Ğ° 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
      pause_on_extreme_volatility: true
```

### ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ

```python
DEFAULT_DCA_CONFIG = {
    'signal_config': {
        'confluence': {
            'enabled': True,
            'min_score': 0.75,
        },
    },
    'order_config': {
        'base_order': {
            'volume_usd': 100,
        },
        'safety_orders': {
            'max_count': 5,
            'volume_multiplier': 1.5,
            'price_step_percent': 2.0,
        },
    },
    'exit_config': {
        'trailing_stop': {
            'enabled': True,
            'activation_profit': 1.5,
            'distance': 0.8,
            'type': 'percentage',
        },
    },
    'risk_config': {
        'max_concurrent_deals': 3,
        'max_daily_loss_usd': 500,
    },
}
```

---

## ğŸ”¨ Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

### 1. DCA Signal Generator

**Ğ¤Ğ°Ğ¹Ğ»:** `src/strategies/dca/dca_signal_generator.py`

```python
from typing import Tuple, Dict, Optional
from dataclasses import dataclass
from datetime import datetime, timedelta

@dataclass
class MarketState:
    """Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ€Ñ‹Ğ½ĞºĞ° Ğ½Ğ° Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚"""
    pair: str
    timestamp: datetime
    price: float
    ema_fast: float
    ema_slow: float
    rsi: float
    adx: float
    volume_24h: float
    bb_lower: float
    bb_upper: float
    nearest_support: Optional[float]

@dataclass
class SignalResult:
    """Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°"""
    should_open: bool
    confluence_score: float
    reason: str
    conditions: Dict[str, bool]
    market_state: MarketState

class DCASignalGenerator:
    """
    Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ DCA ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸
    """

    def __init__(self, exchange_client, config):
        self.exchange = exchange_client
        self.config = config

    async def analyze_market(self, pair: str) -> MarketState:
        """
        ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ€Ñ‹Ğ½ĞºĞ°
        """
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€Ñ‹Ğ½ĞºĞ°
        ohlcv = await self.exchange.fetch_ohlcv(pair, timeframe='1h', limit=100)
        ticker = await self.exchange.fetch_ticker(pair)

        # Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹
        prices = [candle[4] for candle in ohlcv]  # close prices

        ema_fast = self._calculate_ema(prices, self.config.signal_config.trend.ema_fast)
        ema_slow = self._calculate_ema(prices, self.config.signal_config.trend.ema_slow)
        rsi = self._calculate_rsi(prices, period=14)
        adx = self._calculate_adx(ohlcv, period=14)
        bb_lower, bb_upper = self._calculate_bollinger_bands(prices, period=20, std=2)

        support = await self._find_nearest_support(pair, prices[-1])

        return MarketState(
            pair=pair,
            timestamp=datetime.utcnow(),
            price=prices[-1],
            ema_fast=ema_fast,
            ema_slow=ema_slow,
            rsi=rsi,
            adx=adx,
            volume_24h=ticker['quoteVolume'],
            bb_lower=bb_lower,
            bb_upper=bb_upper,
            nearest_support=support,
        )

    async def should_open_deal(self, pair: str) -> SignalResult:
        """
        Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¸Ñ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ ÑĞ´ĞµĞ»ĞºĞ¸
        """
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ€Ñ‹Ğ½ĞºĞ°
        market = await self.analyze_market(pair)

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
        conditions = {
            'trend': self._check_trend_conditions(market),
            'price': self._check_price_conditions(market),
            'indicators': self._check_indicator_conditions(market),
            'risk': await self._check_risk_filters(pair),
            'timing': await self._check_timing_filters(pair),
        }

        # Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ confluence
        confluence = self._calculate_confluence(conditions, market)

        # ĞŸÑ€Ğ¸Ğ½ÑÑ‚ÑŒ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ
        if self.config.signal_config.confluence.enabled:
            should_open = confluence >= self.config.signal_config.confluence.min_score
            reason = f"Confluence: {confluence:.2%}"
        else:
            should_open = all(conditions.values())
            reason = "All conditions met" if should_open else "Conditions not met"

        return SignalResult(
            should_open=should_open,
            confluence_score=confluence,
            reason=reason,
            conditions=conditions,
            market_state=market,
        )

    def _check_trend_conditions(self, market: MarketState) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ñ€ĞµĞ½Ğ´Ğ¾Ğ²Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹"""
        trend_config = self.config.signal_config.trend

        # ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ñ€ĞµĞ½Ğ´Ğ°
        if trend_config.direction == 'down':
            trend_direction_ok = market.ema_fast < market.ema_slow
        elif trend_config.direction == 'up':
            trend_direction_ok = market.ema_fast > market.ema_slow
        else:  # any
            trend_direction_ok = True

        # Ğ¡Ğ¸Ğ»Ğ° Ñ‚Ñ€ĞµĞ½Ğ´Ğ°
        trend_strength_ok = market.adx > trend_config.min_strength

        return trend_direction_ok and trend_strength_ok

    def _check_price_conditions(self, market: MarketState) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ†ĞµĞ½Ğ¾Ğ²Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹"""
        price_config = self.config.signal_config.price

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğ°
        if price_config.entry_range:
            in_range = (
                price_config.entry_range.min <= market.price <= price_config.entry_range.max
            )
        else:
            in_range = True

        # Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸
        if market.nearest_support:
            distance = (market.price - market.nearest_support) / market.nearest_support
            near_support = distance <= price_config.max_distance_from_support
        else:
            near_support = True

        return in_range and near_support

    def _check_indicator_conditions(self, market: MarketState) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹"""
        ind_config = self.config.signal_config.indicators

        # RSI
        rsi_ok = market.rsi < ind_config.rsi_threshold

        # Bollinger Bands
        if ind_config.use_bollinger_bands:
            at_bb_lower = market.price <= market.bb_lower * 1.02
        else:
            at_bb_lower = True

        # Volume
        avg_volume = await self._get_average_volume(market.pair, days=30)
        volume_ok = market.volume_24h > avg_volume * ind_config.min_volume_multiplier

        return rsi_ok and at_bb_lower and volume_ok

    async def _check_risk_filters(self, pair: str) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ¸ÑĞº-Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²"""
        filters = self.config.signal_config.filters

        # ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞ´ĞµĞ»Ğ¾Ğº
        active_deals = await self.db.count_active_deals(pair)
        if active_deals >= filters.max_concurrent_deals:
            return False

        # Ğ”Ğ½ĞµĞ²Ğ½Ğ¾Ğ¹ ÑƒĞ±Ñ‹Ñ‚Ğ¾Ğº
        daily_pnl = await self.db.get_daily_pnl()
        if daily_pnl < -filters.max_daily_loss:
            return False

        # Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ
        balance = await self.exchange.fetch_balance()
        required = self._calculate_required_capital()
        if balance['USDT']['free'] < required:
            return False

        return True

    async def _check_timing_filters(self, pair: str) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²"""
        filters = self.config.signal_config.filters

        # Ğ’Ñ€ĞµĞ¼Ñ Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ ÑĞ´ĞµĞ»ĞºĞ¸
        last_deal = await self.db.get_last_closed_deal(pair)
        if last_deal:
            time_since = (datetime.utcnow() - last_deal.closed_at).total_seconds()
            if time_since < filters.min_time_between_deals:
                return False

        # Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ñ‹Ğµ Ñ‡Ğ°ÑÑ‹
        if filters.trading_hours:
            current_hour = datetime.utcnow().hour
            if current_hour not in filters.trading_hours:
                return False

        return True

    def _calculate_confluence(self, conditions: Dict[str, bool], market: MarketState) -> float:
        """
        Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ confluence score
        """
        weights = {
            'trend': 3,
            'price': 2,
            'indicators': 2,
            'risk': 1,
            'timing': 1,
        }

        total_weight = sum(weights.values())
        achieved_weight = sum(weights[k] for k, v in conditions.items() if v)

        return achieved_weight / total_weight

    # ... Ğ²ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² ...
```

### 2. DCA Position Manager

**Ğ¤Ğ°Ğ¹Ğ»:** `src/strategies/dca/dca_position_manager.py`

```python
from typing import List, Optional
from decimal import Decimal
from dataclasses import dataclass

@dataclass
class SafetyOrderConfig:
    """ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ°"""
    level: int  # 1, 2, 3, ...
    price: Decimal
    volume: Decimal
    cost: Decimal

class DCAPositionManager:
    """
    Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ DCA Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸ÑĞ¼Ğ¸
    """

    def __init__(self, exchange_client, database, config):
        self.exchange = exchange_client
        self.db = database
        self.config = config

    async def open_deal(
        self,
        pair: str,
        entry_price: float,
        signal_result: SignalResult
    ) -> DCADeal:
        """
        ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²ÑƒÑ DCA-ÑĞ´ĞµĞ»ĞºÑƒ
        """
        base_order_config = self.config.order_config.base_order

        # Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑŠĞµĞ¼ base order
        volume_usd = base_order_config.volume_usd
        volume = Decimal(volume_usd) / Decimal(entry_price)

        # Ğ Ğ°Ğ·Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ base order
        order = await self.exchange.create_market_buy_order(
            pair,
            float(volume)
        )

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Ğ‘Ğ”
        deal = DCADeal(
            pair=pair,
            strategy_id=self.config.id,
            status='active',
            base_order_price=Decimal(entry_price),
            base_order_volume=volume,
            base_order_cost=Decimal(volume_usd),
            average_entry_price=Decimal(entry_price),
            total_volume=volume,
            total_cost=Decimal(volume_usd),
            highest_price_since_entry=Decimal(entry_price),  # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
            max_safety_orders=self.config.order_config.safety_orders.max_count,
            config=self.config.to_dict(),
        )

        await self.db.save_deal(deal)

        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ€Ğ´ĞµÑ€
        await self.db.save_order(DCAOrder(
            deal_id=deal.id,
            exchange_order_id=order['id'],
            order_type='base_order',
            side='buy',
            price=Decimal(entry_price),
            volume=volume,
            filled_volume=volume,
            cost=Decimal(volume_usd),
            status='filled',
        ))

        # Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ safety orders
        safety_orders = self.calculate_safety_orders(deal)
        deal.next_safety_order_price = safety_orders[0].price
        await self.db.update_deal(deal)

        return deal

    def calculate_safety_orders(self, deal: DCADeal) -> List[SafetyOrderConfig]:
        """
        Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ²ÑĞµÑ… safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ²
        """
        so_config = self.config.order_config.safety_orders

        safety_orders = []
        current_price = deal.base_order_price
        current_volume_usd = deal.base_order_cost

        for level in range(1, so_config.max_count + 1):
            # Ğ¦ĞµĞ½Ğ° safety order
            price_drop_percent = so_config.price_step_percent * level
            so_price = current_price * (1 - Decimal(price_drop_percent) / 100)

            # ĞĞ±ÑŠĞµĞ¼ safety order
            so_volume_usd = current_volume_usd * Decimal(so_config.volume_multiplier ** level)
            so_volume = so_volume_usd / so_price

            safety_orders.append(SafetyOrderConfig(
                level=level,
                price=so_price,
                volume=so_volume,
                cost=so_volume_usd,
            ))

        return safety_orders

    async def place_safety_order(self, deal: DCADeal, level: int) -> DCAOrder:
        """
        Ğ Ğ°Ğ·Ğ¼ĞµÑ‰Ğ°ĞµÑ‚ safety order
        """
        safety_orders = self.calculate_safety_orders(deal)
        so_config = safety_orders[level - 1]

        # Ğ Ğ°Ğ·Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ market buy order
        order = await self.exchange.create_market_buy_order(
            deal.pair,
            float(so_config.volume)
        )

        # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ´ĞµĞ»ĞºÑƒ
        deal.total_volume += so_config.volume
        deal.total_cost += so_config.cost
        deal.average_entry_price = deal.total_cost / deal.total_volume
        deal.safety_orders_count += 1

        # Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ safety order
        if level < len(safety_orders):
            deal.next_safety_order_price = safety_orders[level].price
        else:
            deal.next_safety_order_price = None

        await self.db.update_deal(deal)

        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ€Ğ´ĞµÑ€
        db_order = DCAOrder(
            deal_id=deal.id,
            exchange_order_id=order['id'],
            order_type=f'safety_order_{level}',
            side='buy',
            price=so_config.price,
            volume=so_config.volume,
            filled_volume=so_config.volume,
            cost=so_config.cost,
            status='filled',
        )
        await self.db.save_order(db_order)

        return db_order

    async def close_deal(
        self,
        deal: DCADeal,
        current_price: float,
        reason: str
    ) -> None:
        """
        Ğ—Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞ´ĞµĞ»ĞºÑƒ (Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞµÑ‚ Ğ²ÑÑ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ)
        """
        # Ğ Ğ°Ğ·Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ market sell order
        order = await self.exchange.create_market_sell_order(
            deal.pair,
            float(deal.total_volume)
        )

        # Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ‚
        sell_value = Decimal(current_price) * deal.total_volume
        profit_usd = sell_value - deal.total_cost
        profit_percent = (profit_usd / deal.total_cost) * 100

        # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ´ĞµĞ»ĞºÑƒ
        deal.status = 'closed'
        deal.closed_at = datetime.utcnow()
        deal.close_reason = reason
        deal.realized_profit_usd = profit_usd
        deal.realized_profit_percent = profit_percent

        await self.db.update_deal(deal)

        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ€Ğ´ĞµÑ€
        await self.db.save_order(DCAOrder(
            deal_id=deal.id,
            exchange_order_id=order['id'],
            order_type=reason,  # 'trailing_stop', 'take_profit', etc.
            side='sell',
            price=Decimal(current_price),
            volume=deal.total_volume,
            filled_volume=deal.total_volume,
            cost=sell_value,
            status='filled',
        ))
```

### 3. Active Deal Manager Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ¾Ğ¼

**Ğ¤Ğ°Ğ¹Ğ»:** `src/strategies/dca/manage_active_deal.py`

```python
import asyncio
from decimal import Decimal
from typing import Optional

class ActiveDealManager:
    """
    Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼Ğ¸ ÑĞ´ĞµĞ»ĞºĞ°Ğ¼Ğ¸ (Ñ†Ğ¸ĞºĞ» Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°)
    """

    def __init__(self, position_manager, exchange_client, database, config):
        self.position_manager = position_manager
        self.exchange = exchange_client
        self.db = database
        self.config = config
        self.running = False

    async def start(self):
        """Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ†Ğ¸ĞºĞ»Ğ° Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°"""
        self.running = True
        while self.running:
            try:
                await self._monitoring_cycle()
                await asyncio.sleep(5)  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 ÑĞµĞºÑƒĞ½Ğ´
            except Exception as e:
                logger.error(f"Error in monitoring cycle: {e}")
                await asyncio.sleep(10)

    async def _monitoring_cycle(self):
        """ĞĞ´Ğ¸Ğ½ Ñ†Ğ¸ĞºĞ» Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ²ÑĞµÑ… Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞ´ĞµĞ»Ğ¾Ğº"""
        active_deals = await self.db.get_active_deals()

        for deal in active_deals:
            try:
                await self.manage_active_deal(deal)
            except Exception as e:
                logger.error(f"Error managing deal {deal.id}: {e}")

    async def manage_active_deal(self, deal: DCADeal) -> None:
        """
        Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ ÑĞ´ĞµĞ»ĞºĞ¾Ğ¹
        Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚:
        - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ¸ Ñ€Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ²
        - Ğ›Ğ¾Ğ³Ğ¸ĞºÑƒ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°
        - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ TP/SL
        """
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ñ†ĞµĞ½Ñƒ
        ticker = await self.exchange.fetch_ticker(deal.pair)
        current_price = Decimal(str(ticker['last']))

        # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ
        current_profit = (current_price - deal.average_entry_price) / deal.average_entry_price * 100
        deal.current_profit_percent = current_profit
        await self.db.update_deal(deal)

        # --- Ğ‘Ğ›ĞĞš 1: Safety Orders ---
        await self._check_safety_orders(deal, current_price)

        # --- Ğ‘Ğ›ĞĞš 2: Trailing Stop ---
        if self.config.exit_config.trailing_stop.enabled:
            exit_triggered = await self._check_trailing_stop(deal, current_price)
            if exit_triggered:
                return  # Ğ¡Ğ´ĞµĞ»ĞºĞ° Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ°

        # --- Ğ‘Ğ›ĞĞš 3: Ğ¤Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Take Profit / Stop Loss ---
        if self.config.exit_config.take_profit.enabled:
            if current_profit >= self.config.exit_config.take_profit.percent:
                await self.position_manager.close_deal(
                    deal,
                    float(current_price),
                    reason='take_profit'
                )
                return

        if self.config.exit_config.stop_loss.enabled:
            stop_loss_percent = -self.config.exit_config.stop_loss.percent
            if current_profit <= stop_loss_percent:
                await self.position_manager.close_deal(
                    deal,
                    float(current_price),
                    reason='stop_loss'
                )
                return

    async def _check_safety_orders(self, deal: DCADeal, current_price: Decimal) -> None:
        """
        ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ Ñ€Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ safety-Ğ¾Ñ€Ğ´ĞµÑ€Ğ¾Ğ²
        """
        if deal.safety_orders_count >= deal.max_safety_orders:
            return  # Ğ’ÑĞµ safety orders ÑƒĞ¶Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ñ‹

        if deal.next_safety_order_price is None:
            return

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ»Ğ° Ğ»Ğ¸ Ñ†ĞµĞ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ SO
        if current_price <= deal.next_safety_order_price:
            # Ğ Ğ°Ğ·Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ safety order
            next_level = deal.safety_orders_count + 1
            await self.position_manager.place_safety_order(deal, next_level)

            # deal ÑƒĞ¶Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ² place_safety_order
            # Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ñ†ĞµĞ½Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ğ°Ğ½Ğ°
            logger.info(
                f"Deal {deal.id}: Placed safety order {next_level} "
                f"at {current_price}. New avg entry: {deal.average_entry_price}"
            )

    async def _check_trailing_stop(self, deal: DCADeal, current_price: Decimal) -> bool:
        """
        Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°
        Returns: True ĞµÑĞ»Ğ¸ ÑĞ´ĞµĞ»ĞºĞ° Ğ±Ñ‹Ğ»Ğ° Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ°
        """
        ts_config = self.config.exit_config.trailing_stop

        # Ğ¨Ğ°Ğ³ 1: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼
        if deal.highest_price_since_entry is None:
            deal.highest_price_since_entry = current_price

        new_highest = max(deal.highest_price_since_entry, current_price)

        # Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼
        if new_highest > deal.highest_price_since_entry:
            deal.highest_price_since_entry = new_highest
            await self.db.update_deal(deal)
            logger.debug(
                f"Deal {deal.id}: New highest price: {new_highest}"
            )

        # Ğ¨Ğ°Ğ³ 2: Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ
        profit_percent = (current_price - deal.average_entry_price) / deal.average_entry_price * 100

        # Ğ¨Ğ°Ğ³ 3: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ
        if profit_percent >= ts_config.activation_profit:
            # Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
            if not deal.trailing_stop_activated:
                deal.trailing_stop_activated = True
                deal.trailing_activation_price = current_price
                deal.trailing_activation_time = datetime.utcnow()
                await self.db.update_deal(deal)
                logger.info(
                    f"Deal {deal.id}: Trailing stop ACTIVATED at {current_price} "
                    f"(profit: {profit_percent:.2f}%)"
                )

            # Ğ¨Ğ°Ğ³ 4: Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ¾Ğ¿-Ñ†ĞµĞ½Ñƒ
            if ts_config.type == 'percentage':
                stop_price = new_highest * (1 - Decimal(ts_config.distance) / 100)
            else:  # absolute
                stop_price = new_highest - Decimal(ts_config.distance)

            logger.debug(
                f"Deal {deal.id}: TS check - "
                f"highest={new_highest}, stop={stop_price}, current={current_price}"
            )

            # Ğ¨Ğ°Ğ³ 5: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ¿Ğ°
            if current_price <= stop_price:
                # Ğ¢Ğ Ğ˜Ğ“Ğ“Ğ•Ğ ! Ğ—Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ´ĞµĞ»ĞºÑƒ
                await self.position_manager.close_deal(
                    deal,
                    float(current_price),
                    reason='trailing_stop'
                )
                logger.info(
                    f"Deal {deal.id}: TRAILING STOP TRIGGERED! "
                    f"Exit at {current_price}, profit: {profit_percent:.2f}%"
                )
                return True

        return False
```

---

## ğŸ”„ ĞŸĞ»Ğ°Ğ½ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

### Ğ§Ñ‚Ğ¾ ÑƒĞ±Ñ€Ğ°Ñ‚ÑŒ

#### 1. Ğ¡Ñ‚Ğ°Ñ€Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ TP (ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ»Ğ°)
```python
# âŒ Ğ£Ğ‘Ğ ĞĞ¢Ğ¬ (ĞµÑĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ»Ğ¾ÑÑŒ Ñ€Ğ°Ğ½ÑŒÑˆĞµ)
if current_price >= take_profit_price:
    close_position()
```

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ½Ğ° Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ Ğ¸Ğ»Ğ¸ Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ ĞºĞ°Ğº fallback.

#### 2. Ğ‘Ğ¸Ñ€Ğ¶ĞµĞ²Ñ‹Ğµ trailing-stop Ğ¾Ñ€Ğ´ĞµÑ€Ğ° (ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ»Ğ¸)
```python
# âŒ Ğ£Ğ‘Ğ ĞĞ¢Ğ¬
exchange.create_order(
    symbol=pair,
    type='TRAILING_STOP_MARKET',
    ...
)
```

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½ÑƒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ.

#### 3. Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
```python
# âŒ Ğ£Ğ‘Ğ ĞĞ¢Ğ¬
TRAILING_DISTANCE = 0.008  # Ğ—Ğ°Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
```

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Ğ’ÑĞµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ² YAML ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸.

### Ğ§Ñ‚Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ

#### 1. ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
```sql
-- ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Alembic
ALTER TABLE dca_deals ADD COLUMN highest_price_since_entry DECIMAL(20, 8);
ALTER TABLE dca_deals ADD COLUMN trailing_stop_activated BOOLEAN DEFAULT FALSE;
ALTER TABLE dca_deals ADD COLUMN trailing_activation_price DECIMAL(20, 8);
ALTER TABLE dca_deals ADD COLUMN trailing_activation_time TIMESTAMP;

CREATE INDEX idx_trailing_activated ON dca_deals(trailing_stop_activated, status);
```

**Ğ¤Ğ°Ğ¹Ğ»:** `alembic/versions/xxx_add_trailing_stop_fields.py`

```python
"""Add trailing stop fields to dca_deals

Revision ID: xxx
Revises: yyy
Create Date: 2026-02-13

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

def upgrade():
    op.add_column('dca_deals', sa.Column('highest_price_since_entry', sa.DECIMAL(20, 8), nullable=True))
    op.add_column('dca_deals', sa.Column('trailing_stop_activated', sa.Boolean(), server_default='false'))
    op.add_column('dca_deals', sa.Column('trailing_activation_price', sa.DECIMAL(20, 8), nullable=True))
    op.add_column('dca_deals', sa.Column('trailing_activation_time', sa.TIMESTAMP(), nullable=True))

    op.create_index('idx_trailing_activated', 'dca_deals', ['trailing_stop_activated', 'status'])

def downgrade():
    op.drop_index('idx_trailing_activated', table_name='dca_deals')
    op.drop_column('dca_deals', 'trailing_activation_time')
    op.drop_column('dca_deals', 'trailing_activation_price')
    op.drop_column('dca_deals', 'trailing_stop_activated')
    op.drop_column('dca_deals', 'highest_price_since_entry')
```

#### 2. ĞĞ¾Ğ²Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ² YAML
```yaml
# config/strategies/dca.yaml
exit_config:
  trailing_stop:
    enabled: true
    activation_profit: 1.5
    distance: 0.8
    type: "percentage"
```

#### 3. ĞĞ¾Ğ²Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
- `src/strategies/dca/dca_signal_generator.py` - Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²
- `src/strategies/dca/dca_position_manager.py` - ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹
- `src/strategies/dca/manage_active_deal.py` - ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞ´ĞµĞ»Ğ¾Ğº
- `src/strategies/dca/trailing_stop.py` - Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° TS (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

#### 4. ĞĞ¾Ğ²Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
- `tests/unit/strategies/dca/test_signal_generator.py`
- `tests/unit/strategies/dca/test_trailing_stop.py`
- `tests/integration/strategies/dca/test_full_deal_cycle.py`

### Ğ§Ñ‚Ğ¾ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ

#### 1. Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ DCA Position Manager
```python
# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ highest_price_since_entry Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ ÑĞ´ĞµĞ»ĞºĞ¸
async def open_deal(...):
    deal = DCADeal(
        ...
        highest_price_since_entry=Decimal(entry_price),  # <- Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬
        ...
    )
```

#### 2. Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ manage_active_deal
```python
# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ»Ğ¾Ğº Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°
async def manage_active_deal(deal, config):
    # Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° safety orders
    await check_safety_orders(...)

    # Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬: Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿
    if config.exit_config.trailing_stop.enabled:
        exit_triggered = await check_trailing_stop(...)
        if exit_triggered:
            return

    # Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° TP/SL
    ...
```

#### 3. ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
```python
# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
class ExitConfig(BaseModel):
    trailing_stop: TrailingStopConfig  # <- Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬
    take_profit: TakeProfitConfig
    stop_loss: StopLossConfig

class TrailingStopConfig(BaseModel):  # <- ĞĞĞ’Ğ«Ğ™ ĞšĞ›ĞĞ¡Ğ¡
    enabled: bool = True
    activation_profit: float = Field(gt=0)
    distance: float = Field(gt=0)
    type: Literal['percentage', 'absolute'] = 'percentage'
```

---

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Unit Tests

#### 1. Ğ¢ĞµÑÑ‚ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°

**Ğ¤Ğ°Ğ¹Ğ»:** `tests/unit/strategies/dca/test_trailing_stop.py`

```python
import pytest
from decimal import Decimal
from datetime import datetime
from src.strategies.dca.manage_active_deal import ActiveDealManager
from src.models.dca import DCADeal

@pytest.fixture
def mock_deal():
    return DCADeal(
        id=1,
        pair="BTC/USDT",
        base_order_price=Decimal('30000'),
        average_entry_price=Decimal('30000'),
        total_volume=Decimal('0.1'),
        highest_price_since_entry=Decimal('30000'),
        trailing_stop_activated=False,
    )

@pytest.fixture
def ts_config():
    return {
        'enabled': True,
        'activation_profit': 1.5,
        'distance': 0.8,
        'type': 'percentage',
    }

class TestTrailingStop:

    async def test_highest_price_updates(self, mock_deal, ts_config):
        """Ğ¢ĞµÑÑ‚: highest_price Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ñ€Ğ¾ÑÑ‚Ğµ Ñ†ĞµĞ½Ñ‹"""
        manager = ActiveDealManager(...)

        # Ğ¦ĞµĞ½Ğ° Ğ²Ñ‹Ñ€Ğ¾ÑĞ»Ğ°
        new_price = Decimal('31000')
        await manager._check_trailing_stop(mock_deal, new_price)

        assert mock_deal.highest_price_since_entry == Decimal('31000')

    async def test_highest_price_not_decreasing(self, mock_deal, ts_config):
        """Ğ¢ĞµÑÑ‚: highest_price ĞĞ• ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¸ Ñ†ĞµĞ½Ñ‹"""
        mock_deal.highest_price_since_entry = Decimal('32000')
        manager = ActiveDealManager(...)

        # Ğ¦ĞµĞ½Ğ° ÑƒĞ¿Ğ°Ğ»Ğ°
        new_price = Decimal('31000')
        await manager._check_trailing_stop(mock_deal, new_price)

        # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ¾ÑÑ‚Ğ°Ğ»ÑÑ Ğ¿Ñ€ĞµĞ¶Ğ½Ğ¸Ğ¼
        assert mock_deal.highest_price_since_entry == Decimal('32000')

    async def test_trailing_activation(self, mock_deal, ts_config):
        """Ğ¢ĞµÑÑ‚: Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸"""
        manager = ActiveDealManager(...)

        # Ğ¦ĞµĞ½Ğ° Ğ²Ñ‹Ñ€Ğ¾ÑĞ»Ğ° Ğ½Ğ° 2% (Ğ±Ğ¾Ğ»ÑŒÑˆĞµ activation_profit=1.5%)
        new_price = Decimal('30600')  # +2%
        await manager._check_trailing_stop(mock_deal, new_price)

        assert mock_deal.trailing_stop_activated == True
        assert mock_deal.trailing_activation_price == Decimal('30600')

    async def test_stop_calculation_percentage(self, mock_deal, ts_config):
        """Ğ¢ĞµÑÑ‚: Ñ€Ğ°ÑÑ‡ĞµÑ‚ ÑÑ‚Ğ¾Ğ¿-Ñ†ĞµĞ½Ñ‹ (percentage)"""
        mock_deal.highest_price_since_entry = Decimal('31000')
        mock_deal.trailing_stop_activated = True

        # distance = 0.8%
        # stop = 31000 * (1 - 0.008) = 30752
        expected_stop = Decimal('30752')

        # Ğ¦ĞµĞ½Ğ° Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹ÑˆĞµ ÑÑ‚Ğ¾Ğ¿Ğ°
        current_price = Decimal('30800')
        exit_triggered = await manager._check_trailing_stop(mock_deal, current_price)

        assert exit_triggered == False

        # Ğ¦ĞµĞ½Ğ° Ğ½Ğ¸Ğ¶Ğµ ÑÑ‚Ğ¾Ğ¿Ğ°
        current_price = Decimal('30700')
        exit_triggered = await manager._check_trailing_stop(mock_deal, current_price)

        assert exit_triggered == True

    async def test_stop_not_triggered_before_activation(self, mock_deal, ts_config):
        """Ğ¢ĞµÑÑ‚: ÑÑ‚Ğ¾Ğ¿ Ğ½Ğµ ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ´Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸"""
        manager = ActiveDealManager(...)

        # Ğ¦ĞµĞ½Ğ° Ğ²Ñ‹Ñ€Ğ¾ÑĞ»Ğ°, Ğ½Ğ¾ Ğ¼ĞµĞ½ÑŒÑˆĞµ activation_profit
        mock_deal.highest_price_since_entry = Decimal('30300')  # +1%
        current_price = Decimal('30000')  # Ğ£Ğ¿Ğ°Ğ»Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾

        exit_triggered = await manager._check_trailing_stop(mock_deal, current_price)

        # Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½, Ğ²Ñ‹Ñ…Ğ¾Ğ´ Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾Ğ¹Ñ‚Ğ¸
        assert exit_triggered == False
        assert mock_deal.trailing_stop_activated == False

    async def test_highest_not_reset_on_safety_order(self, mock_deal, ts_config):
        """Ğ¢ĞµÑÑ‚: highest ĞĞ• ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ safety order"""
        mock_deal.highest_price_since_entry = Decimal('31500')
        mock_deal.average_entry_price = Decimal('30000')

        # Safety order (Ñ†ĞµĞ½Ğ° ÑƒĞ¿Ğ°Ğ»Ğ°, ÑÑ€ĞµĞ´Ğ½ÑÑ Ñ†ĞµĞ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ°ÑÑŒ)
        await position_manager.place_safety_order(mock_deal, level=1)

        # Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ñ†ĞµĞ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ°ÑÑŒ, Ğ½Ğ¾ highest Ğ¾ÑÑ‚Ğ°Ğ»ÑÑ
        assert mock_deal.highest_price_since_entry == Decimal('31500')
```

#### 2. Ğ¢ĞµÑÑ‚ ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸

**Ğ¤Ğ°Ğ¹Ğ»:** `tests/unit/strategies/dca/test_signal_generator.py`

```python
import pytest
from src.strategies.dca.dca_signal_generator import DCASignalGenerator

class TestSignalGenerator:

    async def test_trend_conditions_downtrend(self):
        """Ğ¢ĞµÑÑ‚: Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰ĞµĞ³Ğ¾ Ñ‚Ñ€ĞµĞ½Ğ´Ğ°"""
        market = MarketState(
            ema_fast=30000,
            ema_slow=31000,
            adx=25,
            ...
        )

        config = {
            'trend': {
                'direction': 'down',
                'min_strength': 20,
            }
        }

        generator = DCASignalGenerator(...)
        result = generator._check_trend_conditions(market)

        assert result == True

    async def test_confluence_calculation(self):
        """Ğ¢ĞµÑÑ‚: Ñ€Ğ°ÑÑ‡ĞµÑ‚ confluence score"""
        conditions = {
            'trend': True,
            'price': True,
            'indicators': True,
            'risk': True,
            'timing': False,
        }

        generator = DCASignalGenerator(...)
        confluence = generator._calculate_confluence(conditions, market)

        # weights: trend=3, price=2, indicators=2, risk=1, timing=1
        # achieved: 3+2+2+1 = 8
        # max: 3+2+2+1+1 = 9
        expected = 8 / 9

        assert confluence == pytest.approx(expected)

    async def test_signal_requires_confluence(self):
        """Ğ¢ĞµÑÑ‚: ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ confluence"""
        # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ñ‚Ğ°Ğº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ confluence=0.6
        # ĞĞ¾ min_score=0.75

        result = await generator.should_open_deal('BTC/USDT')

        assert result.should_open == False
        assert result.confluence_score < 0.75
```

### Integration Tests

#### 1. ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» DCA-ÑĞ´ĞµĞ»ĞºĞ¸ Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ¾Ğ¼

**Ğ¤Ğ°Ğ¹Ğ»:** `tests/integration/strategies/dca/test_full_deal_cycle.py`

```python
import pytest
import asyncio
from decimal import Decimal

class TestFullDealCycle:

    @pytest.mark.asyncio
    async def test_dca_with_trailing_stop_success(self):
        """
        Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚: Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» DCA Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ¾Ğ¼

        Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:
        1. ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ base order @ 30000
        2. ĞŸĞ°Ğ´ĞµĞ½Ğ¸Ğµ, safety order 1 @ 29400
        3. ĞŸĞ°Ğ´ĞµĞ½Ğ¸Ğµ, safety order 2 @ 28800
        4. Ğ Ğ¾ÑÑ‚ Ñ†ĞµĞ½Ñ‹ @ 31000 (Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³Ğ°)
        5. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾ÑÑ‚Ğ° @ 32000
        6. ĞÑ‚ĞºĞ°Ñ‚ @ 31744 (ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ¿Ğ°)
        """
        # Setup
        exchange_mock = MockExchange()
        db = TestDatabase()
        config = load_test_config()

        signal_generator = DCASignalGenerator(...)
        position_manager = DCAPositionManager(...)
        active_manager = ActiveDealManager(...)

        # 1. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°
        exchange_mock.set_price('BTC/USDT', 30000)
        signal = await signal_generator.should_open_deal('BTC/USDT')
        assert signal.should_open == True

        # 2. ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑĞ´ĞµĞ»ĞºĞ¸
        deal = await position_manager.open_deal('BTC/USDT', 30000, signal)
        assert deal.status == 'active'
        assert deal.highest_price_since_entry == Decimal('30000')

        # 3. ĞŸĞ°Ğ´ĞµĞ½Ğ¸Ğµ Ñ†ĞµĞ½Ñ‹ â†’ Safety Order 1
        exchange_mock.set_price('BTC/USDT', 29400)
        await active_manager.manage_active_deal(deal)

        deal = await db.get_deal(deal.id)
        assert deal.safety_orders_count == 1
        assert deal.average_entry_price < Decimal('30000')

        # 4. ĞŸĞ°Ğ´ĞµĞ½Ğ¸Ğµ Ñ†ĞµĞ½Ñ‹ â†’ Safety Order 2
        exchange_mock.set_price('BTC/USDT', 28800)
        await active_manager.manage_active_deal(deal)

        deal = await db.get_deal(deal.id)
        assert deal.safety_orders_count == 2

        # 5. Ğ Ğ¾ÑÑ‚ Ñ†ĞµĞ½Ñ‹ â†’ ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³Ğ°
        exchange_mock.set_price('BTC/USDT', 31000)
        await active_manager.manage_active_deal(deal)

        deal = await db.get_deal(deal.id)
        assert deal.highest_price_since_entry == Decimal('31000')
        assert deal.trailing_stop_activated == True
        assert deal.status == 'active'  # Ğ•Ñ‰Ğµ Ğ½Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ°

        # 6. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾ÑÑ‚Ğ° â†’ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ highest
        exchange_mock.set_price('BTC/USDT', 32000)
        await active_manager.manage_active_deal(deal)

        deal = await db.get_deal(deal.id)
        assert deal.highest_price_since_entry == Decimal('32000')
        assert deal.status == 'active'

        # 7. ĞÑ‚ĞºĞ°Ñ‚ â†’ Ğ¡Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°
        # stop = 32000 * (1 - 0.008) = 31744
        exchange_mock.set_price('BTC/USDT', 31744)
        await active_manager.manage_active_deal(deal)

        deal = await db.get_deal(deal.id)
        assert deal.status == 'closed'
        assert deal.close_reason == 'trailing_stop'
        assert deal.realized_profit_percent > 0
```

### Backtesting

#### 1. Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ TP vs Trailing Stop

**Ğ¤Ğ°Ğ¹Ğ»:** `tests/backtesting/test_trailing_vs_fixed_tp.py`

```python
async def test_compare_fixed_tp_vs_trailing_stop():
    """
    Ğ‘ÑĞºÑ‚ĞµÑÑ‚: ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ TP Ğ¸ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°

    Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ğ´Ğ½Ğ¸ Ğ¸ Ñ‚Ğµ Ğ¶Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:
    - Config 1: Fixed TP 3%
    - Config 2: Trailing Stop (activation 1.5%, distance 0.8%)
    """
    historical_data = load_historical_data('BTC/USDT', '2025-01-01', '2025-12-31')

    # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ 1: Fixed TP
    config_fixed = {
        'exit_config': {
            'take_profit': {'enabled': True, 'percent': 3.0},
            'trailing_stop': {'enabled': False},
        }
    }

    # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ 2: Trailing Stop
    config_trailing = {
        'exit_config': {
            'take_profit': {'enabled': False},
            'trailing_stop': {
                'enabled': True,
                'activation_profit': 1.5,
                'distance': 0.8,
            },
        }
    }

    # Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±ÑĞºÑ‚ĞµÑÑ‚Ğ¾Ğ²
    results_fixed = await run_backtest(historical_data, config_fixed)
    results_trailing = await run_backtest(historical_data, config_trailing)

    # Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
    print(f"Fixed TP:")
    print(f"  Total Return: {results_fixed.total_return:.2%}")
    print(f"  Sharpe Ratio: {results_fixed.sharpe_ratio:.2f}")
    print(f"  Max Drawdown: {results_fixed.max_drawdown:.2%}")
    print(f"  Avg Win: {results_fixed.avg_win:.2%}")

    print(f"\nTrailing Stop:")
    print(f"  Total Return: {results_trailing.total_return:.2%}")
    print(f"  Sharpe Ratio: {results_trailing.sharpe_ratio:.2f}")
    print(f"  Max Drawdown: {results_trailing.max_drawdown:.2%}")
    print(f"  Avg Win: {results_trailing.avg_win:.2%}")

    # ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ÑÑ, Ñ‡Ñ‚Ğ¾ trailing stop Ğ´Ğ°ÑÑ‚ Ğ»ÑƒÑ‡ÑˆĞ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    assert results_trailing.total_return > results_fixed.total_return
    assert results_trailing.avg_win > results_fixed.avg_win
```

---

## ğŸ“Š Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: Ğ£ÑĞ¿ĞµÑˆĞ½Ğ°Ñ ÑĞ´ĞµĞ»ĞºĞ° Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ¾Ğ¼

```
Ğ’Ñ€ĞµĞ¼Ñ  | Ğ¦ĞµĞ½Ğ°   | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ                     | Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑĞ´ĞµĞ»ĞºĞ¸
-------|--------|------------------------------|------------------
T0     | 30000  | Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ğ½Ğ° Ğ²Ñ…Ğ¾Ğ´               | -
T1     | 30000  | Base order @ 30000 (0.1 BTC) | Avg: 30000, Vol: 0.1
T2     | 29400  | Safety order 1 @ 29400       | Avg: 29700, Vol: 0.25
T3     | 28800  | Safety order 2 @ 28800       | Avg: 29200, Vol: 0.475
       |        |                              | Highest: 28800
T4     | 29500  | Ğ Ğ¾ÑÑ‚, Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³             | Highest: 29500
T5     | 30200  | Ğ Ğ¾ÑÑ‚, Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³             | Highest: 30200
       |        |                              | Profit: +3.4%
T6     | 31000  | TRAILING ACTIVATED!          | Highest: 31000
       |        | (profit > 1.5%)              | Stop: 30752
T7     | 32000  | Ğ Ğ¾ÑÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµÑ‚ÑÑ            | Highest: 32000
       |        |                              | Stop: 31744
T8     | 33000  | ĞĞ¾Ğ²Ñ‹Ğ¹ maximum                | Highest: 33000
       |        |                              | Stop: 32736
T9     | 32700  | ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¾Ñ‚ĞºĞ°Ñ‚              | Highest: 33000
       |        | (Ğ²Ñ‹ÑˆĞµ ÑÑ‚Ğ¾Ğ¿Ğ°)                 | Stop: 32736
T10    | 32600  | STOP TRIGGERED!              | EXIT @ 32600
       |        | Sell 0.475 BTC @ 32600       | Profit: +11.6%
```

**Ğ˜Ñ‚Ğ¾Ğ³:** ĞŸÑ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ 11.6% vs Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TP 3% - Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ 8.6%!

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: ĞŸÑ€ĞµĞ¶Ğ´ĞµĞ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ñ…Ğ¾Ğ´ (Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ¹)

```
Ğ’Ñ€ĞµĞ¼Ñ  | Ğ¦ĞµĞ½Ğ°   | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ                     | Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑĞ´ĞµĞ»ĞºĞ¸
-------|--------|------------------------------|------------------
T0     | 30000  | Base order                   | Avg: 30000
T1     | 29400  | Safety order 1               | Avg: 29700
T2     | 30150  | Ğ Ğ¾ÑÑ‚                         | Highest: 30150
       |        | Profit: +1.5%                | TRAILING ACTIVATED
       |        |                              | Stop: 30030
T3     | 29950  | Ğ›Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ¹ Ğ²Ğ½Ğ¸Ğ·           | STOP TRIGGERED
       |        | Sell @ 29950                 | Profit: +0.84%
```

**ĞĞ½Ğ°Ğ»Ğ¸Ğ·:**
- Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»ÑÑ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ€Ğ°Ğ½Ğ¾ (1.5%)
- ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¾Ñ‚ĞºĞ°Ñ‚ Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ» Ğ²Ñ‹Ñ…Ğ¾Ğ´
- **Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ `activation_profit` Ğ´Ğ¾ 2-3%

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ (ÑĞ´ĞµĞ»ĞºĞ° Ğ² ÑƒĞ±Ñ‹Ñ‚ĞºĞµ)

```
Ğ’Ñ€ĞµĞ¼Ñ  | Ğ¦ĞµĞ½Ğ°   | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ                     | Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑĞ´ĞµĞ»ĞºĞ¸
-------|--------|------------------------------|------------------
T0     | 30000  | Base order                   | Avg: 30000
T1     | 29400  | Safety order 1               | Avg: 29700
T2     | 28800  | Safety order 2               | Avg: 29200
T3     | 28200  | Safety order 3               | Avg: 28800
T4     | 29000  | Ğ Ğ¾ÑÑ‚, Ğ½Ğ¾ profit < 1.5%       | Highest: 29000
       |        | Profit: +0.69%               | Trailing NOT active
T5     | 28500  | Ğ¦ĞµĞ½Ğ° ÑĞ½Ğ¾Ğ²Ğ° Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚            | Highest: 29000
T6     | 27000  | Ğ¡Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ stop-loss       | EXIT @ 27000
       |        | Sell @ 27000                 | Profit: -6.25%
```

**ĞĞ½Ğ°Ğ»Ğ¸Ğ·:**
- Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»ÑÑ (Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ Ğ½Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ»Ğ° 1.5%)
- Ğ¡Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ stop-loss
- Ğ­Ñ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ - Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… ÑƒĞ±Ñ‹Ñ‚ĞºĞ¾Ğ²

---

## ğŸ“ˆ ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

**Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ: Fixed TP 3% vs Trailing Stop (1.5% / 0.8%)**

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Fixed TP 3% | Trailing Stop | Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ |
|---------|-------------|---------------|-----------|
| Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ | +3.0% | +5.2% | +73% |
| ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ | +3.0% | +18.5% | +516% |
| Win Rate | 65% | 62% | -5% |
| Profit Factor | 1.8 | 2.4 | +33% |
| Sharpe Ratio | 1.2 | 1.6 | +33% |
| Max Drawdown | -8% | -7.5% | +6% |

**Ğ’Ñ‹Ğ²Ğ¾Ğ´Ñ‹:**
- Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ Ğ´Ğ°ĞµÑ‚ **Ğ²Ñ‹ÑˆĞµ ÑÑ€ĞµĞ´Ğ½ÑÑ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ** Ğ·Ğ° ÑÑ‡ĞµÑ‚ ÑƒĞ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹ Ğ² Ñ‚Ñ€ĞµĞ½Ğ´Ğµ
- Win rate Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ½Ğ¸Ğ¶Ğµ (Ğ¿Ñ€ĞµĞ¶Ğ´ĞµĞ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ñ‹ Ğ½Ğ° Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ°Ñ…)
- **ĞĞ±Ñ‰Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ»ÑƒÑ‡ÑˆĞµ** (Profit Factor, Sharpe Ratio)

### Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹

#### Ğ”Ğ»Ñ Ğ²Ğ¾Ğ»Ğ°Ñ‚Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ñ€Ñ‹Ğ½ĞºĞ¾Ğ² (BTC, ETH)
```yaml
trailing_stop:
  activation_profit: 2.5  # Ğ’Ñ‹ÑˆĞµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸
  distance: 1.0           # Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
  type: percentage
```

#### Ğ”Ğ»Ñ Ğ½Ğ¸Ğ·ĞºĞ¾Ğ²Ğ¾Ğ»Ğ°Ñ‚Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ñ€Ñ‹Ğ½ĞºĞ¾Ğ² (altcoins)
```yaml
trailing_stop:
  activation_profit: 1.5
  distance: 0.6
  type: percentage
```

#### Ğ”Ğ»Ñ ranging markets
```yaml
trailing_stop:
  activation_profit: 1.0  # Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ
  distance: 0.5           # Ğ£Ğ·ĞºĞ¸Ğ¹ ÑÑ‚Ğ¾Ğ¿
  type: percentage
```

---

## âœ… Checklist Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Phase 1: ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° (1-2 Ğ´Ğ½Ñ)
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ²ĞµÑ‚ĞºÑƒ `feature/dca-trailing-stop`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Alembic Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ‘Ğ”
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ORM Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (DCADeal, DCAOrder, DCASignal)
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ² YAML
- [ ] ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ (Pydantic)

### Phase 2: Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° (2-3 Ğ´Ğ½Ñ)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `DCASignalGenerator`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ğ¾Ğ²Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ†ĞµĞ½Ğ¾Ğ²Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑÑ‡ĞµÑ‚ confluence
- [ ] ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ½Ğ¸Ñ‚-Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²

### Phase 3: Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ (2-3 Ğ´Ğ½Ñ)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `_check_trailing_stop()` Ğ² `ActiveDealManager`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ `highest_price_since_entry`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³Ğ°
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑ‡ĞµÑ‚ ÑÑ‚Ğ¾Ğ¿-Ñ†ĞµĞ½Ñ‹ (percentage & absolute)
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¿Ğ°
- [ ] ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ½Ğ¸Ñ‚-Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°

### Phase 4: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ (2 Ğ´Ğ½Ñ)
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ² Ñ†Ğ¸ĞºĞ» ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿ Ğ² `manage_active_deal`
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `open_deal` Ğ´Ğ»Ñ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ `highest_price`
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `place_safety_order` (Ğ½Ğµ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ highest)
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹

### Phase 5: Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (3-4 Ğ´Ğ½Ñ)
- [ ] ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑÑ‚Ğ¸ Ğ±ÑĞºÑ‚ĞµÑÑ‚ Ğ½Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- [ ] Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹: Fixed TP vs Trailing Stop
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° testnet Bybit (2-3 Ğ´Ğ½Ñ)
- [ ] ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹

### Phase 6: Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ (1 Ğ´ĞµĞ½ÑŒ)
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ README Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿Ğ°
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
- [ ] ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ troubleshooting guide
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

### Phase 7: Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ (1 Ğ´ĞµĞ½ÑŒ)
- [ ] Code review
- [ ] Merge Ğ² main
- [ ] Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞ½ (Ñ Ğ¼Ğ°Ğ»Ñ‹Ğ¼ ĞºĞ°Ğ¿Ğ¸Ñ‚Ğ°Ğ»Ğ¾Ğ¼)
- [ ] ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ 24-48 Ñ‡Ğ°ÑĞ¾Ğ²
- [ ] ĞŸĞ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾Ğµ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ¿Ğ¸Ñ‚Ğ°Ğ»Ğ°

---

## ğŸ“ ĞĞ±ÑƒÑ‡Ğ°ÑÑ‰Ğ¸Ğµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹

### Ğ”Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²

**ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿:**
1. Ğ’Ğ¸Ğ´ĞµĞ¾: [Trailing Stop Explained](https://example.com/trailing-stop-tutorial)
2. Ğ¡Ñ‚Ğ°Ñ‚ÑŒÑ: [Implementing Trailing Stops in Python](https://example.com/article)

**ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:**
- Observer pattern Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ñ†ĞµĞ½Ñ‹
- State machine Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ´ĞµĞ»ĞºĞ¾Ğ¹
- Strategy pattern Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ°

### Ğ”Ğ»Ñ Ñ‚Ñ€ĞµĞ¹Ğ´ĞµÑ€Ğ¾Ğ²

**ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³-ÑÑ‚Ğ¾Ğ¿:**
- âœ… Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹ (protection of unrealized profit)
- âœ… Breakout scenarios
- âœ… ĞĞ¸Ğ·ĞºĞ°Ñ Ğ²Ğ¾Ğ»Ğ°Ñ‚Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (tight stops)
- âŒ Ranging markets (false triggers)
- âŒ Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ²Ğ¾Ğ»Ğ°Ñ‚Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (premature exits)

**ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²:**
- `activation_profit`: Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ€Ğ°Ğ½Ğ½Ğ¸Ğ¼ Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ¼ Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹
- `distance`: Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑƒĞ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹ Ğ¾Ñ‚ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¾Ğ²

---

## ğŸ“ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹

**ĞŸÑ€Ğ¸ Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼:**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸: `/var/log/traderagent/dca.log`
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ‘Ğ”: `SELECT * FROM dca_deals WHERE status='active'`
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ: `config/strategies/dca.yaml`

**Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹:**
- Q: Ğ¢Ñ€ĞµĞ¹Ğ»Ğ¸Ğ½Ğ³ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ?
  A: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ `activation_profit` - Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ Ğ½Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ»Ğ° Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°.

- Q: Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ñ‹?
  A: Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ÑŒÑ‚Ğµ `distance` Ğ¸Ğ»Ğ¸ `activation_profit`.

- Q: ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ?
  A: Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚Ğµ `distance`, Ğ½Ğ¾ Ğ±ÑƒĞ´ÑŒÑ‚Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğº Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¼ ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸ÑĞ¼.

---

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½.**
**ĞĞ²Ñ‚Ğ¾Ñ€:** AI Assistant
**Ğ”Ğ°Ñ‚Ğ°:** 2026-02-13
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0
