# TRADERAGENT - План развития

> Дата: 2026-02-24
> Текущая версия: v2.0.0
> На основе: [Анализ проекта](analysis.md)

---

## Направления развития

Каждое направление представлено с описанием, обоснованием и задачами по приоритетам (P0 — критический, P1 — высокий, P2 — средний, P3 — низкий).

---

## Направление 1: Адаптивная торговля

**Цель**: Бот автоматически переключает стратегии в зависимости от состояния рынка.

**Обоснование**: MarketRegimeDetector уже работает и классифицирует 6 режимов рынка, но результат игнорируется в главном торговом цикле. Это главный архитектурный gap проекта — минимальные изменения дадут максимальный эффект.

### Задачи

| # | Приоритет | Задача | Оценка | Зависимости |
|---|-----------|--------|--------|-------------|
| 1.1 | P0 | Подключить `get_strategy_recommendation()` к `_main_loop()` — читать `_current_regime` и выбирать активную стратегию | 2-3 дня | — |
| 1.2 | P0 | Реализовать GracefulTransition: при смене режима корректно закрывать ордера текущей стратегии перед активацией новой | 3-4 дня | 1.1 |
| 1.3 | P1 | Добавить cooldown между переключениями (5-10 мин) для защиты от осцилляций на границе режимов | 1 день | 1.1 |
| 1.4 | P1 | Интеграция HybridStrategy с MarketRegimeDetector: вместо ADX-only, использовать 6-режимный классификатор | 2 дня | 1.1 |
| 1.5 | P2 | Тесты: unit-тесты для MarketRegimeDetector + integration-тесты для переключения стратегий | 2 дня | 1.1, 1.2 |
| 1.6 | P2 | Telegram-уведомления о смене режима и переключении стратегий | 1 день | 1.1 |
| 1.7 | P3 | Dashboard: визуализация текущего режима и истории переключений | 2 дня | 1.1 |

---

## Направление 2: Бэктестинг и аналитика

**Цель**: Завершить pipeline бэктестинга, исправить SMC, получить оптимальные параметры стратегий.

**Обоснование**: Pipeline на 48,400 тестов запущен, но SMC-стратегия тратит ресурсы впустую (0 сделок, 1.4 ГБ логов-спама). DCA и TrendFollower, вероятно, считаются нормально, но результаты не получены.

### Задачи

| # | Приоритет | Задача | Оценка | Зависимости |
|---|-----------|--------|--------|-------------|
| 2.1 | P0 | Fix SMC warmup: добавить skip первых N баров (N = max(swing_length*4, 100)), логировать только один раз | 1 день | — |
| 2.2 | P0 | Подавить лог-спам: `Liquidity detection failed` и `Insufficient data` — одна запись в начале, counter в конце | 0.5 дня | — |
| 2.3 | P0 | Разделить pipeline: запустить DCA + TF без SMC → получить результаты Phase 2-5 | 1 день | — |
| 2.4 | P1 | Запустить SMC pipeline отдельно после исправлений (2.1, 2.2) | 1 день | 2.1, 2.2 |
| 2.5 | P1 | Анализ результатов Phase 2-5: топ-5 пар для каждой стратегии, оптимальные параметры | 2 дня | 2.3 |
| 2.6 | P1 | Автоматический `post_pipeline_archive.sh` с Telegram-уведомлением и остановкой Yandex Cloud VM | 1 день | — |
| 2.7 | P2 | Backtesting UI: визуализация equity curves, drawdown charts, сравнение стратегий в веб-дашборде | 5 дней | 2.5 |
| 2.8 | P2 | Walk-forward analysis (Phase 5): in-sample/out-of-sample валидация лучших параметров | 3 дня | 2.5 |
| 2.9 | P3 | Monte Carlo simulation для оценки робастности параметров | 3 дня | 2.5 |

---

## Направление 3: Scanner Bot

**Цель**: Автоматический выбор торговых пар и стратегий на основе текущих рыночных условий.

**Обоснование**: Сейчас пары и стратегии назначаются вручную. Scanner Bot будет сканировать рынок, классифицировать пары по режимам и автоматически запускать оптимальные стратегии.

### Задачи

| # | Приоритет | Задача | Оценка | Зависимости |
|---|-----------|--------|--------|-------------|
| 3.1 | P1 | Market Scanner: модуль сканирования N пар каждые M минут через Bybit API (volume filter + spread filter) | 3 дня | — |
| 3.2 | P1 | Pair Classifier: классификация каждой пары через MarketRegimeDetector → рекомендация стратегии | 2 дня | 1.1 |
| 3.3 | P1 | Bot Launcher: автоматический старт/стоп ботов по результатам сканирования с cooldown | 3 дня | 3.1, 3.2 |
| 3.4 | P2 | Capital Allocator: распределение капитала между активными ботами по confidence и риску | 3 дня | 3.3 |
| 3.5 | P2 | Blacklist/Whitelist: настраиваемые списки пар (исключить LUNA, приоритизировать BTC/ETH) | 1 день | 3.1 |
| 3.6 | P2 | Correlation Monitor: не открывать позиции в сильно коррелированных парах одновременно | 3 дня | 3.3 |
| 3.7 | P2 | Telegram: уведомления о найденных возможностях, запуске/остановке ботов | 1 день | 3.3 |
| 3.8 | P3 | Scheduling: настраиваемое расписание сканирования (каждые 5/15/60 мин) с разными профилями | 1 день | 3.1 |

---

## Направление 4: Качество кода и технический долг

**Цель**: Устранить накопленный технический долг, повысить надёжность и maintainability.

**Обоснование**: Дублирование моделей, falling web tests, mypy исключения для критичных файлов — всё это увеличивает риск регрессий и усложняет развитие.

### Задачи

| # | Приоритет | Задача | Оценка | Зависимости |
|---|-----------|--------|--------|-------------|
| 4.1 | P1 | Консолидация моделей: объединить `models.py`, `models_v2.py`, `models_state.py` в единую схему | 2 дня | — |
| 4.2 | P1 | Починить 26 failing web tests (password issue) | 1 день | — |
| 4.3 | P1 | Убрать mypy exclude для `bot_orchestrator.py`, `config/manager.py`, `exchange_client.py` — добавить type hints | 3 дня | — |
| 4.4 | P2 | Перенести legacy тесты из `bot/tests/` в `tests/`, удалить дубликаты | 1 день | — |
| 4.5 | P2 | Добавить unit-тесты для SMC стратегии | 2 дня | — |
| 4.6 | P2 | Добавить unit-тесты для MarketRegimeDetector | 1 день | — |
| 4.7 | P2 | Performance benchmarks: baseline для key operations (order placement latency, regime detection time) | 2 дня | — |
| 4.8 | P3 | Graceful strategy switch: при `/switch_strategy` закрывать открытые ордера текущей стратегии | 2 дня | 1.2 |

---

## Направление 5: Инфраструктура и безопасность

**Цель**: Повысить надёжность, безопасность и автоматизацию инфраструктуры.

**Обоснование**: Нет автоматического бэкапа БД, Web API без rate limiting, Redis без пароля, Yandex Cloud VM требует ручной остановки.

### Задачи

| # | Приоритет | Задача | Оценка | Зависимости |
|---|-----------|--------|--------|-------------|
| 5.1 | P0 | Автоматический бэкап PostgreSQL: cron job + копирование на удалённое хранилище | 0.5 дня | — |
| 5.2 | P1 | Rate limiting для Web API (slowapi или custom middleware) | 1 день | — |
| 5.3 | P1 | Redis password + ACL в Docker Compose | 0.5 дня | — |
| 5.4 | P1 | Yandex Cloud автоматизация: скрипт auto-stop VM после завершения pipeline (yc CLI или API) | 1 день | — |
| 5.5 | P2 | 2FA для веб-дашборда (TOTP) | 3 дня | — |
| 5.6 | P2 | Audit log: запись всех действий пользователей (login, start/stop bot, config changes) | 2 дня | — |
| 5.7 | P2 | SSL для PostgreSQL (обязательный для удалённых подключений) | 0.5 дня | — |
| 5.8 | P3 | Chaos testing: сценарии сбоев сети, БД, Redis с автоматическим восстановлением | 3 дня | — |
| 5.9 | P3 | Log aggregation: ELK/Loki для централизованного анализа логов | 3 дня | — |

---

## Направление 6: ML/AI оптимизация

**Цель**: Использование машинного обучения для оптимизации параметров и принятия решений.

**Обоснование**: Сейчас параметры стратегий подбираются grid search. ML может находить нелинейные зависимости, адаптироваться к изменениям рынка и оптимизировать capital allocation.

### Задачи

| # | Приоритет | Задача | Оценка | Зависимости |
|---|-----------|--------|--------|-------------|
| 6.1 | P2 | Bayesian Optimization для параметров стратегий (вместо grid search) на основе результатов бэктестов | 5 дней | 2.5 |
| 6.2 | P2 | Feature engineering: создание ML-фич из рыночных данных (RSI, ATR, volume, spread, order book imbalance) | 3 дня | — |
| 6.3 | P3 | Regime classification ML-модель: обучить classifier на исторических данных вместо rule-based | 5 дней | 6.2 |
| 6.4 | P3 | Reinforcement Learning: агент для capital allocation между стратегиями | 10 дней | 3.4, 6.2 |
| 6.5 | P3 | Sentiment analysis: новости и social media как дополнительный сигнал | 5 дней | — |

---

## Направление 7: Масштабирование и мульти-биржевость

**Цель**: Поддержка нескольких бирж одновременно, масштабирование на большее количество пар и стратегий.

**Обоснование**: Сейчас реально работает только Bybit. CCXT поддерживает 150+ бирж, но нативные клиенты для Demo/Sandbox нужны для каждой биржи отдельно.

### Задачи

| # | Приоритет | Задача | Оценка | Зависимости |
|---|-----------|--------|--------|-------------|
| 7.1 | P2 | Binance DirectClient для Testnet (аналог ByBitDirectClient) | 3 дня | — |
| 7.2 | P2 | Cross-exchange arbitrage detection (информационный, без торговли) | 3 дня | 7.1 |
| 7.3 | P3 | Multi-exchange portfolio: единый P&L и риск-менеджмент через несколько бирж | 5 дней | 7.1 |
| 7.4 | P3 | Kubernetes: переход с Docker Compose для горизонтального масштабирования | 5 дней | — |
| 7.5 | P3 | Spot trading support для Demo (или реализация mock-spot через linear) | 2 дня | — |

---

## Приоритизированный план (Roadmap)

### Фаза 1 — Стабилизация (1-2 недели)

Устранение критических проблем, получение результатов бэктестинга.

| Задача | Из направления | Приоритет |
|--------|---------------|-----------|
| Fix SMC warmup + лог-спам | 2.1, 2.2 | P0 |
| Запустить DCA + TF pipeline (без SMC) | 2.3 | P0 |
| Подключить MarketRegimeDetector к main loop | 1.1 | P0 |
| GracefulTransition при смене режима | 1.2 | P0 |
| Автоматический бэкап PostgreSQL | 5.1 | P0 |

### Фаза 2 — Аналитика (2-4 недели)

Анализ результатов, оптимизация параметров, код quality.

| Задача | Из направления | Приоритет |
|--------|---------------|-----------|
| Анализ результатов Phase 2-5 | 2.5 | P1 |
| Запустить SMC pipeline отдельно | 2.4 | P1 |
| Cooldown для переключений + HybridStrategy | 1.3, 1.4 | P1 |
| Консолидация моделей данных | 4.1 | P1 |
| Fix web tests + mypy для критичных файлов | 4.2, 4.3 | P1 |
| Rate limiting для Web API | 5.2 | P1 |
| Redis password | 5.3 | P1 |
| Yandex Cloud auto-stop | 5.4 | P1 |

### Фаза 3 — Scanner Bot (1-2 месяца)

Автоматический выбор пар и стратегий.

| Задача | Из направления | Приоритет |
|--------|---------------|-----------|
| Market Scanner | 3.1 | P1 |
| Pair Classifier | 3.2 | P1 |
| Bot Launcher | 3.3 | P1 |
| Capital Allocator | 3.4 | P2 |
| Correlation Monitor | 3.6 | P2 |
| Backtesting UI | 2.7 | P2 |

### Фаза 4 — ML и масштабирование (3-6 месяцев)

AI-оптимизация, мульти-биржевость.

| Задача | Из направления | Приоритет |
|--------|---------------|-----------|
| Bayesian Optimization | 6.1 | P2 |
| Binance DirectClient | 7.1 | P2 |
| Feature engineering | 6.2 | P2 |
| RL для capital allocation | 6.4 | P3 |
| Kubernetes | 7.4 | P3 |

---

## KPI для отслеживания прогресса

| Метрика | Текущее значение | Целевое (Фаза 2) | Целевое (Фаза 4) |
|---------|-----------------|-------------------|-------------------|
| Стратегии с бэктест-верификацией | 2/5 (Grid, DCA) | 4/5 | 5/5 |
| Адаптивное переключение | Нет | Да | ML-driven |
| Активных пар в Scanner | 0 | 5-10 | 20-45 |
| Поддержанных бирж (реально) | 1 (Bybit) | 1 | 2-3 |
| Тесты passing | 1,531 | 1,600+ | 2,000+ |
| Web tests failing | 26 | 0 | 0 |
| Mypy excluded files | 3 критичных | 0 | 0 |
| DB backup | Нет | Ежедневный | + point-in-time recovery |
